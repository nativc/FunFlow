## 个人信息展示

### 需求分析

- 当用户登录成功后，页面右上角的登录按钮变为用户头像
- 用户点击页面左侧导航栏，跳转到个人主页，展示的信息包括：头像、昵称、账号、关注数、粉丝数、获赞数、个性签名

### 涉及接口

- 获取用户信息 - `GET /api/user/profile`

## 修改个人资料

### 需求分析
- 用户可自由修改的信息包括：头像、昵称、账号、个性签名
- 账号不能重复，数据库查重时忽略大小写
- 头像和个性签名理论上需要进行审核，审核通过后才算修改成功

### 前后端交互流程
采用两步接口的方案，先传头像获取 URL，再提交资料：
1. 前端先调用「头像上传接口」，将头像文件传给后端，后端上传到 OSS 后返回新的 URL。
2. 前端拿到 URL 后，和其他用户资料（昵称、个性签名等）一起调用「资料更新接口」，后端更新数据库。

> 进阶方案：前端直传 OSS，减轻后端服务器压力

### 涉及接口

- 用户头像上传 - `POST /api/user/profile/avatar`
- 用户资料更新 - `POST /api/user/profile`

### 前端直传 OSS + 异步审核流程

```mermaid
sequenceDiagram
    participant F as 前端
    participant B as 后端
    participant O as OSS
    participant M as 内容审核服务

    F->>B: 1. 获取 OSS 上传凭证
    B-->>F: 返回临时上传权限

    F->>O: 2. 直传新头像到 OSS
    O-->>F: 返回新头像 URL

    F->>B: 3. 提交资料（含新头像 URL）

    B->>B: 校验头像 URL 合法性
    B->>B: 将新头像 URL 存入「待审核头像表」（user_id 唯一）
    B->>M: 异步发起内容审核
    B->>B: 更新「用户表」用户其他资料（如昵称）
    B-->>F: 返回用户信息（头像仍为旧值）

    Note right of F: 审核期间，前端继续显示旧头像

    alt 审核通过
        M-->>B: 通知审核通过
        B->>B: 将新头像 URL 写入用户主表
        B->>B: 删除「待审核头像表」中的记录
        B->>F: （可选）WebSocket / 轮询通知：头像已生效
    else 审核不通过
        M-->>B: 通知审核失败
        B->>B: 删除「待审核头像表」中的记录
        B->>B: （可选）删除 OSS 上的违规图片
        B->>F: （可选）通知：头像未通过审核
    end

    Note right of F: 此后所有页面自动显示新头像（若通过）
```
